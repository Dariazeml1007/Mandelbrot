
![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π](Mandelbrot.png)


# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ú–∞–Ω–¥–µ–ª—å–±—Ä–æ—Ç–∞
*–¶–µ–ª–∏* : 
     1)–ò–∑–æ–æ–±—Ä–∞–∑–∏—Ç—å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ú–∞–Ω–¥–µ–ª—å–±—Ä–æ—Ç–∞.
     2)–ù–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–∏ –≤–∞—Ä–∏–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å —Ä–∞–∑–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π —Ä–∞—Å—á–µ—Ç–∞.
     3)–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º.

## üñ•Ô∏è –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –≤–µ—Ä—Å–∏—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤—É –ú–∞–Ω–¥–µ–ª—å–±—Ä–æ—Ç–∞. 
 ### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1.–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

2.–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ 800x600 –ø–∏–∫—Å–µ–ª–µ–π

3.–ú–∞—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è 
- –î–≤–∏–∂–µ–Ω–∏–µ –≤ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä–µ–ª–æ–∫, c –ø–æ–º–æ—â—å—é '+' –∏ '-' –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –º–∞—à—Ç–∞–±–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
- –ö–ª–∞–≤–∏—à–∞ Esc –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞, –∫–ª–∞–≤–∏—à–∞ Space –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—à—Ç–∞–±–∞ –∫ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º—É.

4.–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å —Ç–µ–∫—É—â–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

5. –¶–≤–µ—Ç–æ–≤–∞—è –≥–∞–º–º–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–æ—Ä–º—É–ª–∞               | –û–ø–∏—Å–∞–Ω–∏–µ                                  | –î–∏–∞–ø–∞–∑–æ–Ω |
|-----------|-----------------------|-------------------------------------------|----------|
| –ö—Ä–∞—Å–Ω—ã–π   | `(iter * 197) & 0xFF` | –ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ 197 —Å–æ–∑–¥–∞–µ—Ç —Ö–∞–æ—Ç–∏—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω | 0-255    |
| –ó–µ–ª–µ–Ω—ã–π   | `(iter * 237) & 0xFF` | –ß–∏—Å–ª–æ 237 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–≤–µ—Ç–æ–≤–æ–π —Ä–∞–∑–±—Ä–æ—Å    | 0-255    |
| –°–∏–Ω–∏–π     | `(iter * 255) & 0xFF` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–∞–π—Ç–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏  | 0-255    |

![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π](–°loseImg.png)



6.–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç --graphics:




## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ 
- x[i] = x[i - 1]^2 - y[i - 1]^2 + x[0]
- y[i] = 2 * x[i - 1] * y[i - 1] + y[0]

  
**–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä:**  
[MinGW-w64](https://www.mingw-w64.org/) GCC 6.3.0 (`g++ (MinGW.org GCC-6.3.0-1) 6.3.0`)

**–£—Ä–æ–≤–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**


| –§–ª–∞–≥       | –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏                                     |     
|------------|----------------------------------------------------|
| `-O2`      | –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏/—Ä–∞–∑–º–µ—Ä–∞ –∫–æ–¥–∞                       | 
| `-O3`      | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è + –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è             | 


## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã
- –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 600*800 –ø–∏–∫—Å–µ–ª–µ–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏: 256
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞ (–∫–≤–∞–¥—Ä–∞—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç —Ü–µ–Ω—Ç—Ä–∞). –ï—Å–ª–∏ x¬≤ + y¬≤ ‚â• R_MAX, —Ç–æ—á–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã—à–µ–¥—à–µ–π –∑–∞ –≥—Ä–∞–Ω–∏—Ü—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ : 4
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ –Ω–∞ 1 –∑–∞–ø—É—Å–∫: 100
- –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ clock()
  
## üöÄ –¢—Ä–∏ –≤–µ—Ä—Å–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
### 1. –ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (Simple)

–ü–æ—Ç–æ—á–µ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:

-O2: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  (11.97 —Å–µ–∫)

-O3: ‚ñà‚ñà‚ñà‚ñà          (6.20 —Å–µ–∫)

```c
int mandelbrot(float x0, float y0, int count_iter) {
    float x = 0, y = 0;
    for (int iter = 0; iter < count_iter; iter++) {
        float x2 = x*x, y2 = y*y;
        if (x2 + y2 >= R_MAX) return iter;
        y = 2*x*y + y0;
        x = x2 - y2 + x0;
    }
    return count_iter;
}
```

#### üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π `-O2` vs `-O3`

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       | `-O2`               | `-O3`               | –≠—Ñ—Ñ–µ–∫—Ç              |
|----------------------|---------------------|---------------------|---------------------|
| **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**       | 34                  | 24                  | -29% —Ä–∞–∑–º–µ—Ä–∞        |
| **–†–µ–≥–∏—Å—Ç—Ä—ã XMM**     | 6                   | 7                   | +1 —Ä–µ–≥–∏—Å—Ç—Ä         |
| **–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã**| 3 branches          | 2 branches          | -33% –≤–µ—Ç–≤–ª–µ–Ω–∏–π     |
| **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**     | ‚ùå –ù–µ—Ç              | ‚ö° –ß–∞—Å—Ç–∏—á–Ω–∞—è        | +15-25% —Å–∫–æ—Ä–æ—Å—Ç–∏   |


### 2. –ì—Ä—É–ø–ø–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Grouped)

–û–±—Ä–∞–±–æ—Ç–∫–∞ 8 —Ç–æ—á–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

-O2:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà (14.17 —Å–µ–∫ )

-O3:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà           (5.76 —Å–µ–∫  )
```c
void mandelbrot(PointGroup *group) {
    float x[8] = {0}, y[8] = {0};
    bool active[8] = {true};
    for (int iter = 0; iter < MAX_ITER; iter++) {
        for (int i = 0; i < 8; i++) {
            if (!active[i]) continue;
            float x2 = x[i]*x[i], y2 = y[i]*y[i];
            if (x2 + y2 >= R_MAX) {
                active[i] = false;
                group->iter[i] = iter;
                continue;
            }
            y[i] = 2*x[i]*y[i] + group->y[i];
            x[i] = x2 - y2 + group->x[i];
        }
    }
}


```
#### üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π `-O2` vs `-O3`

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞          | `-O2`                   | `-O3`                   | –≠—Ñ—Ñ–µ–∫—Ç                   |
|-------------------------|-------------------------|-------------------------|--------------------------|
| **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**          | 34                      | 24 (-30%)              | –ú–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤|
| **–†–∞–∑–≤–µ—Ä—Ç–∫–∞ —Ü–∏–∫–ª–æ–≤**    | ‚ùå –ù–µ—Ç                  | ‚úÖ –î–∞                   | –ú–µ–Ω—å—à–µ –≤–µ—Ç–≤–ª–µ–Ω–∏–π         |
| **–†–µ–≥–∏—Å—Ç—Ä—ã XMM**       | `5 xmm`                | `6 xmm`                | –õ—É—á—à–µ–µ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ |
| **–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã**   | 6 branches              | 4 branches (-33%)      | –ü—Ä–æ—â–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ       |
| **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**        | ‚ùå –ù–µ—Ç                  | ‚ö° –ß–∞—Å—Ç–∏—á–Ω–∞—è            | +25% —Å–∫–æ—Ä–æ—Å—Ç–∏            |



### 3. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è AVX (Intrinsics)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 256-–±–∏—Ç–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:

-O2:  1.20  —Å–µ–∫ [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà]

-O3:  1.19  —Å–µ–∫ [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà]

```c
void mandelbrot_avx(PointGroup* group) {
    __m256 x = _mm256_setzero_ps();
    __m256 y = _mm256_setzero_ps();
    __m256 x0 = _mm256_load_ps(group->x);
    __m256 y0 = _mm256_load_ps(group->y);
    
    __m256 active = _mm256_set1_ps(-1.0f);
    __m256i res = _mm256_setzero_si256();
    
    for (int iter = 0; iter < MAX_ITER; iter++) {
        __m256 x2 = _mm256_mul_ps(x, x);
        __m256 y2 = _mm256_mul_ps(y, y);
        __m256 mask = _mm256_cmp_ps(_mm256_add_ps(x2, y2), 
               _mm256_set1_ps(R_MAX), _CMP_LT_OS);
        
        active = _mm256_and_ps(active, mask);
        res = _mm256_sub_epi32(res, _mm256_castps_si256(mask));
        
        __m256 xy = _mm256_mul_ps(x, y);
        x = _mm256_add_ps(_mm256_sub_ps(x2, y2), x0);
        y = _mm256_add_ps(_mm256_add_ps(xy, xy), y0);
        
        if (_mm256_testz_ps(active, active)) break;
    }
    _mm256_store_si256((__m256i*)group->iter, res);
}
```

–î–ª—è –¥–∞–Ω–Ω–æ–π AVX-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∞—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–ª—è -O2 –∏ -O3.
–ü—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–∞–∑–ª–∏—á–∏–π:

- –§—É–Ω–∫—Ü–∏—è —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é

- –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç 256-–±–∏—Ç–Ω—ã–µ YMM-—Ä–µ–≥–∏—Å—Ç—Ä—ã

- –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- –¶–∏–∫–ª –ø—Ä–µ–¥–µ–ª—å–Ω–æ —É–ø—Ä–æ—â—ë–Ω
## üìä –ú–µ—Ç–æ–¥–∏–∫–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π 


![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π](Graph.png)






## üìå –í—ã–≤–æ–¥—ã
–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5.27 —Ä–∞–∑ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π


