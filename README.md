# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ú–∞–Ω–¥–µ–ª—å–±—Ä–æ—Ç–∞
üñ•Ô∏è –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –≤–µ—Ä—Å–∏—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤—É –ú–∞–Ω–¥–µ–ª—å–±—Ä–æ—Ç–∞. 
## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–æ 800x600 –ø–∏–∫—Å–µ–ª–µ–π

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Å—à—Ç–∞–±–∞

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å —Ç–µ–∫—É—â–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç --graphics:
![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π](Mandelbrot.png)

üöÄ –¢—Ä–∏ –≤–µ—Ä—Å–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
1. –ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (Simple)
–ü–æ—Ç–æ—á–µ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:

```c
int mandelbrot(float x0, float y0, int count_iter) {
    float x = 0, y = 0;
    for (int iter = 0; iter < count_iter; iter++) {
        float x2 = x*x, y2 = y*y;
        if (x2 + y2 >= R_MAX) return iter;
        y = 2*x*y + y0;
        x = x2 - y2 + x0;
    }
    return count_iter;
}
```
2. –ì—Ä—É–ø–ø–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Grouped)
–û–±—Ä–∞–±–æ—Ç–∫–∞ 8 —Ç–æ—á–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

```c
void mandelbrot(PointGroup *group) {
    float x[8] = {0}, y[8] = {0};
    bool active[8] = {true};
    for (int iter = 0; iter < MAX_ITER; iter++) {
        for (int i = 0; i < 8; i++) {
            if (!active[i]) continue;
            float x2 = x[i]*x[i], y2 = y[i]*y[i];
            if (x2 + y2 >= R_MAX) {
                active[i] = false;
                group->iter[i] = iter;
                continue;
            }
            y[i] = 2*x[i]*y[i] + groupl->y[i];
            x[i] = x2 - y2 + group->x[i];
        }
    }
}
```
3. –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è AVX (Intrinsics)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 256-–±–∏—Ç–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:

```c
void mandelbrot_avx(PointGroup* group) {
    __m256 x = _mm256_setzero_ps();
    __m256 y = _mm256_setzero_ps();
    __m256 x0 = _mm256_load_ps(group->x);
    __m256 y0 = _mm256_load_ps(group->y);
    
    __m256 active = _mm256_set1_ps(-1.0f);
    __m256i res = _mm256_setzero_si256();
    
    for (int iter = 0; iter < MAX_ITER; iter++) {
        __m256 x2 = _mm256_mul_ps(x, x);
        __m256 y2 = _mm256_mul_ps(y, y);
        __m256 mask = _mm256_cmp_ps(_mm256_add_ps(x2, y2), 
               _mm256_set1_ps(R_MAX), _CMP_LT_OS);
        
        active = _mm256_and_ps(active, mask);
        res = _mm256_sub_epi32(res, _mm256_castps_si256(mask));
        
        __m256 xy = _mm256_mul_ps(x, y);
        x = _mm256_add_ps(_mm256_sub_ps(x2, y2), x0);
        y = _mm256_add_ps(_mm256_add_ps(xy, xy), y0);
        
        if (_mm256_testz_ps(active, active)) break;
    }
    _mm256_store_si256((__m256i*)group->iter, res);
}
```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏



–ì—Ä–∞—Ñ–∏–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π:

![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π](First_version.png)
–í–µ—Ä—Å–∏—è –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏(–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ)
![–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏](Third_version.png)
–í–µ—Ä—Å–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∏–Ω—Ç—Ä–∏–Ω—Å–∏–∫–∞–º–∏



Simple –≤–µ—Ä—Å–∏—è: k = 0.000190

Intrinsics –≤–µ—Ä—Å–∏—è: k = 0.000036

–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ ~5.27 —Ä–∞–∑ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è AVX2 ‚Äî 8x)

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π

‚ùì –ü–æ—á–µ–º—É –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤ 8 —Ä–∞–∑?

–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:

–û–ø–µ—Ä–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å–∫–∞–º–∏ (active, mask)

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ (_mm256_castps_si256)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏:

–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AVX

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è



üìå –í—ã–≤–æ–¥—ã
–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5.27 —Ä–∞–∑ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π


